<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="theme-color" content="#080c10">
  <title>Acoustic Field Pro — Professional Audio Analyzer</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link rel="stylesheet" href="style.css">
</head>
<body>
<div id="app">

  <!-- ======================================================================
       HEADER
       ====================================================================== -->
  <header id="header">
    <div class="brand">
      <div class="brand-icon">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/>
        </svg>
      </div>
      <div>
        <div class="brand-name">Acoustic Field Pro</div>
        <div class="brand-sub">OrdoAudio DSP Engine v1.0</div>
      </div>
    </div>

    <div class="header-controls">
      <!-- Status pills -->
      <div class="status-pills">
        <div id="pill-status" class="status-pill">
          <span id="led-status" class="led"></span>
          <span>STANDBY</span>
        </div>
        <div id="pill-clip" class="status-pill">
          <span id="led-clip" class="led"></span>
          <span>CLIP</span>
        </div>
        <div id="pill-fdbk" class="status-pill">
          <span id="led-fdbk" class="led"></span>
          <span>FDBK</span>
        </div>
        <div class="status-pill" style="min-width:42px;">
          <span id="led-tp" class="led"></span>
          <span id="true-peak-led-label">TP</span>
        </div>
      </div>

      <!-- Power button -->
      <button id="power-btn" aria-label="Start/Stop engine">
        <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
          <path d="M18.36 6.64a9 9 0 1 1-12.73 0"/>
          <line x1="12" y1="2" x2="12" y2="12"/>
        </svg>
        <span id="power-btn-text">INIT ENG</span>
      </button>
    </div>
  </header>

  <!-- ======================================================================
       MAIN CONTENT GRID
       ====================================================================== -->
  <main id="main">

    <!-- === METRICS ROW === -->
    <div id="metrics-row">

      <!-- Level -->
      <div class="metric-card">
        <div class="metric-label">RMS Level</div>
        <div>
          <span id="val-level" class="metric-value">-∞</span>
          <span class="metric-unit">dBFS</span>
        </div>
        <div class="level-bar-wrap">
          <div id="meter-level" class="level-bar"></div>
        </div>
        <div class="metric-sub">Peak: <span id="val-peak">-∞</span> dB</div>
      </div>

      <!-- Pitch -->
      <div class="metric-card">
        <div class="metric-label">Pitch (YIN)</div>
        <div>
          <span id="val-freq" class="metric-value">--</span>
          <span class="metric-unit">Hz</span>
        </div>
        <div style="display:flex;align-items:baseline;gap:6px;margin-top:3px;">
          <span id="val-note" class="font-display text-green" style="font-size:18px;font-weight:700;font-family:var(--font-display)">--</span>
          <span id="val-note-detail" class="font-mono text-dim" style="font-size:10px;"></span>
        </div>
      </div>

      <!-- BPM -->
      <div class="metric-card">
        <div class="metric-label">Tempo / BPM</div>
        <div>
          <span id="val-bpm" class="metric-value">--</span>
          <span class="metric-unit">bpm</span>
        </div>
        <div id="val-bpm-conf" class="metric-sub">tracking...</div>
      </div>

      <!-- Key -->
      <div class="metric-card">
        <div class="metric-label">Est. Key</div>
        <div style="display:flex;align-items:baseline;gap:6px;">
          <span id="val-key" class="metric-value">--</span>
          <span id="val-key-mode" class="metric-unit" style="color:#4a6070;">--</span>
        </div>
        <div class="metric-sub">Chromagram analysis</div>
      </div>

    </div><!-- /metrics-row -->


    <!-- === RTA PANEL === -->
    <div id="rta-panel" class="panel">
      <div class="panel-header">
        <span class="panel-title">Real-Time Analyzer — 1/3 Octave ISO</span>
        <span class="panel-badge">31 BANDS · LOG FREQ</span>
      </div>
      <div id="rta-canvas-wrap">
        <canvas id="rta-canvas"></canvas>
        <div class="freq-axis">
          <span>20</span><span>63</span><span>125</span><span>250</span>
          <span>500</span><span>1k</span><span>2k</span><span>4k</span>
          <span>8k</span><span>16k</span><span>20k</span>
        </div>
        <div class="db-axis">
          <span>0</span><span>-25</span><span>-50</span><span>-75</span><span>-100</span>
        </div>
      </div>
    </div>

    <!-- === SIDEBAR === -->
    <aside id="sidebar">

      <!-- Tab nav -->
      <div class="panel" style="flex-shrink:0;">
        <div class="tab-bar">
          <button class="tab-btn active" data-tab="loudness">Loudness</button>
          <button class="tab-btn" data-tab="spectral">Spectral</button>
          <button class="tab-btn" data-tab="chroma">Chroma</button>
          <button class="tab-btn" data-tab="diag">Diag</button>
        </div>

        <!-- TAB: Loudness -->
        <div id="tab-loudness" class="tab-content active">

          <!-- LUFS -->
          <div class="metric-label" style="margin-bottom:6px;">LUFS (EBU R128 / BS.1770)</div>
          <div class="lufs-bars">
            <div class="lufs-row">
              <span class="lufs-row-label">M</span>
              <div class="lufs-bar-wrap"><div id="bar-lufs-m" class="lufs-bar"></div></div>
              <span id="lufs-m" class="lufs-val">-∞</span>
            </div>
            <div class="lufs-row">
              <span class="lufs-row-label">S</span>
              <div class="lufs-bar-wrap"><div id="bar-lufs-s" class="lufs-bar"></div></div>
              <span id="lufs-s" class="lufs-val">-∞</span>
            </div>
            <div class="lufs-row">
              <span class="lufs-row-label">I</span>
              <div class="lufs-bar-wrap"><div id="bar-lufs-i" class="lufs-bar" style="background:var(--cyan)"></div></div>
              <span id="lufs-i" class="lufs-val">-∞</span>
            </div>
          </div>
          <div style="display:flex;justify-content:space-between;align-items:center;margin-top:8px;">
            <span class="metric-label" style="margin:0">Loudness Range</span>
            <span id="lufs-lra" class="font-mono text-green" style="font-size:11px;">--</span>
          </div>

          <hr style="border:none;border-top:1px solid var(--border);margin:10px 0;">

          <!-- True Peak & Dynamics -->
          <div class="metric-label" style="margin-bottom:6px;">True Peak & Dynamics</div>
          <div class="diag-grid">
            <div class="diag-cell">
              <div class="diag-cell-label">True Peak</div>
              <div id="true-peak-val" class="diag-cell-value">-∞<span style="font-size:8px;color:#2a4050;">dBTP</span></div>
              <span id="true-peak-led" class="led" style="margin-top:4px;"></span>
            </div>
            <div class="diag-cell">
              <div class="diag-cell-label">Crest Factor</div>
              <div id="crest-val" class="diag-cell-value">--<span style="font-size:8px;color:#2a4050;">dB</span></div>
            </div>
            <div class="diag-cell">
              <div class="diag-cell-label">Dyn Range</div>
              <div id="dr-val" class="diag-cell-value">--<span style="font-size:8px;color:#2a4050;">dB</span></div>
            </div>
          </div>
          <div style="margin-top:6px;display:flex;justify-content:space-between;align-items:center;">
            <span class="metric-label" style="margin:0">Compression Est.</span>
            <span id="compr-val" class="font-mono" style="font-size:11px;color:#5a8090;">--</span>
          </div>

          <hr style="border:none;border-top:1px solid var(--border);margin:10px 0;">

          <!-- EQ Profile -->
          <div class="metric-label" style="margin-bottom:6px;">Energy Distribution</div>
          <div class="eq-bars">
            <div class="eq-col">
              <div class="eq-bar-bg"><div id="bar-low" class="eq-bar low"></div></div>
              <span class="eq-label">LOW</span>
            </div>
            <div class="eq-col">
              <div class="eq-bar-bg"><div id="bar-mid" class="eq-bar mid"></div></div>
              <span class="eq-label">MID</span>
            </div>
            <div class="eq-col">
              <div class="eq-bar-bg"><div id="bar-high" class="eq-bar high"></div></div>
              <span class="eq-label">HIGH</span>
            </div>
          </div>

        </div><!-- /tab-loudness -->

        <!-- TAB: Spectral -->
        <div id="tab-spectral" class="tab-content">

          <div class="metric-label" style="margin-bottom:8px;">Spectral Features</div>
          <div class="diag-grid" style="grid-template-columns:repeat(2,1fr);">
            <div class="diag-cell">
              <div class="diag-cell-label">Centroid</div>
              <div id="centroid-val" class="diag-cell-value" style="font-size:12px;">--</div>
            </div>
            <div class="diag-cell">
              <div class="diag-cell-label">Flatness</div>
              <div id="flatness-val" class="diag-cell-value" style="font-size:12px;">--</div>
            </div>
            <div class="diag-cell">
              <div class="diag-cell-label">Rolloff</div>
              <div id="rolloff-val" class="diag-cell-value" style="font-size:12px;">--</div>
            </div>
            <div class="diag-cell">
              <div class="diag-cell-label">Bandwidth</div>
              <div id="bandwidth-val" class="diag-cell-value" style="font-size:12px;">--</div>
            </div>
          </div>

          <hr style="border:none;border-top:1px solid var(--border);margin:10px 0;">

          <!-- THD -->
          <div style="display:flex;align-items:baseline;gap:8px;margin-bottom:6px;">
            <span class="metric-label" style="margin:0">THD</span>
            <span id="thd-val" class="metric-value" style="font-size:16px;">--</span>
          </div>
          <div class="harmonic-bars">
            <!-- Harmonic bars H2–H8 -->
            <div class="harmonic-col"><div class="harmonic-bar-bg"><div class="harmonic-bar"></div></div><span class="harmonic-n">H2</span></div>
            <div class="harmonic-col"><div class="harmonic-bar-bg"><div class="harmonic-bar"></div></div><span class="harmonic-n">H3</span></div>
            <div class="harmonic-col"><div class="harmonic-bar-bg"><div class="harmonic-bar"></div></div><span class="harmonic-n">H4</span></div>
            <div class="harmonic-col"><div class="harmonic-bar-bg"><div class="harmonic-bar"></div></div><span class="harmonic-n">H5</span></div>
            <div class="harmonic-col"><div class="harmonic-bar-bg"><div class="harmonic-bar"></div></div><span class="harmonic-n">H6</span></div>
            <div class="harmonic-col"><div class="harmonic-bar-bg"><div class="harmonic-bar"></div></div><span class="harmonic-n">H7</span></div>
            <div class="harmonic-col"><div class="harmonic-bar-bg"><div class="harmonic-bar"></div></div><span class="harmonic-n">H8</span></div>
          </div>

          <hr style="border:none;border-top:1px solid var(--border);margin:10px 0;">

          <!-- MFCC -->
          <div class="metric-label" style="margin-bottom:6px;">MFCC (Timbre Fingerprint)</div>
          <div class="mfcc-grid">
            <!-- 13 MFCC coefficient bars -->
            <div class="mfcc-bar-wrap"><div class="mfcc-bar"></div></div>
            <div class="mfcc-bar-wrap"><div class="mfcc-bar"></div></div>
            <div class="mfcc-bar-wrap"><div class="mfcc-bar"></div></div>
            <div class="mfcc-bar-wrap"><div class="mfcc-bar"></div></div>
            <div class="mfcc-bar-wrap"><div class="mfcc-bar"></div></div>
            <div class="mfcc-bar-wrap"><div class="mfcc-bar"></div></div>
            <div class="mfcc-bar-wrap"><div class="mfcc-bar"></div></div>
            <div class="mfcc-bar-wrap"><div class="mfcc-bar"></div></div>
            <div class="mfcc-bar-wrap"><div class="mfcc-bar"></div></div>
            <div class="mfcc-bar-wrap"><div class="mfcc-bar"></div></div>
            <div class="mfcc-bar-wrap"><div class="mfcc-bar"></div></div>
            <div class="mfcc-bar-wrap"><div class="mfcc-bar"></div></div>
            <div class="mfcc-bar-wrap"><div class="mfcc-bar"></div></div>
          </div>

        </div><!-- /tab-spectral -->

        <!-- TAB: Chroma -->
        <div id="tab-chroma" class="tab-content">

          <div class="metric-label" style="margin-bottom:6px;">Chromagram (12 Pitch Classes)</div>
          <div class="chroma-grid">
            <!-- 12 note classes -->
            <div class="chroma-bar-wrap"><div class="chroma-bar-bg"><div class="chroma-bar"></div></div><span class="chroma-label">C</span></div>
            <div class="chroma-bar-wrap"><div class="chroma-bar-bg"><div class="chroma-bar"></div></div><span class="chroma-label">C#</span></div>
            <div class="chroma-bar-wrap"><div class="chroma-bar-bg"><div class="chroma-bar"></div></div><span class="chroma-label">D</span></div>
            <div class="chroma-bar-wrap"><div class="chroma-bar-bg"><div class="chroma-bar"></div></div><span class="chroma-label">D#</span></div>
            <div class="chroma-bar-wrap"><div class="chroma-bar-bg"><div class="chroma-bar"></div></div><span class="chroma-label">E</span></div>
            <div class="chroma-bar-wrap"><div class="chroma-bar-bg"><div class="chroma-bar"></div></div><span class="chroma-label">F</span></div>
            <div class="chroma-bar-wrap"><div class="chroma-bar-bg"><div class="chroma-bar"></div></div><span class="chroma-label">F#</span></div>
            <div class="chroma-bar-wrap"><div class="chroma-bar-bg"><div class="chroma-bar"></div></div><span class="chroma-label">G</span></div>
            <div class="chroma-bar-wrap"><div class="chroma-bar-bg"><div class="chroma-bar"></div></div><span class="chroma-label">G#</span></div>
            <div class="chroma-bar-wrap"><div class="chroma-bar-bg"><div class="chroma-bar"></div></div><span class="chroma-label">A</span></div>
            <div class="chroma-bar-wrap"><div class="chroma-bar-bg"><div class="chroma-bar"></div></div><span class="chroma-label">A#</span></div>
            <div class="chroma-bar-wrap"><div class="chroma-bar-bg"><div class="chroma-bar"></div></div><span class="chroma-label">B</span></div>
          </div>

          <hr style="border:none;border-top:1px solid var(--border);margin:10px 0;">

          <!-- Phase Correlation -->
          <div class="metric-label" style="margin-bottom:6px;">Phase Correlation</div>
          <div class="phase-meter-wrap">
            <div id="phase-needle" class="phase-needle" style="left:100%"></div>
          </div>
          <div class="phase-labels">
            <span>-1 (Anti-Phase)</span>
            <span>0</span>
            <span>+1 (Mono)</span>
          </div>
          <div style="display:flex;justify-content:space-between;margin-top:6px;">
            <span id="phase-str" class="font-mono" style="font-size:11px;color:#5a8090;">--</span>
            <span id="phase-corr" class="font-mono" style="font-size:11px;color:#2a4050;">--</span>
          </div>

          <hr style="border:none;border-top:1px solid var(--border);margin:10px 0;">

          <!-- RT60 -->
          <div style="display:flex;align-items:baseline;gap:8px;margin-bottom:6px;">
            <span class="metric-label" style="margin:0">RT60 Reverb Time</span>
            <span id="rt60-val" class="font-mono text-cyan" style="font-size:12px;">Measuring...</span>
          </div>
          <div class="metric-sub">Time for sound to decay 60 dB after source stop</div>

        </div><!-- /tab-chroma -->

        <!-- TAB: Diagnostics -->
        <div id="tab-diag" class="tab-content">

          <!-- SNR -->
          <div style="display:flex;align-items:baseline;gap:8px;margin-bottom:6px;">
            <span class="metric-label" style="margin:0;">Signal/Noise Ratio</span>
            <span id="snr-val" class="font-display text-green" style="font-size:16px;font-weight:700">--</span>
          </div>
          <div style="display:flex;justify-content:space-between;">
            <span class="metric-sub">Noise floor:</span>
            <span id="noise-floor" class="font-mono" style="font-size:10px;color:#2a4050;">--</span>
          </div>

          <hr style="border:none;border-top:1px solid var(--border);margin:10px 0;">

          <!-- ZCR & DC Offset -->
          <div class="diag-grid" style="grid-template-columns:repeat(2,1fr);margin-bottom:0;">
            <div class="diag-cell">
              <div class="diag-cell-label">ZCR</div>
              <div id="zcr-val" class="diag-cell-value" style="font-size:12px;">--</div>
              <div id="zcr-type" class="diag-cell-label" style="margin-top:2px;color:#4a6070;">--</div>
            </div>
            <div class="diag-cell">
              <div class="diag-cell-label">DC Offset</div>
              <div id="dc-val" class="diag-cell-value" style="font-size:12px;">--</div>
              <div id="dc-severity" class="metric-value" style="font-size:10px;margin-top:2px;">--</div>
            </div>
          </div>

          <hr style="border:none;border-top:1px solid var(--border);margin:10px 0;">

          <!-- Standing Waves -->
          <div class="metric-label" style="margin-bottom:6px;">Room Mode Detector (20–300 Hz)</div>
          <div id="modes-container" class="mode-list">
            <div class="text-dim font-mono" style="font-size:10px;padding:4px">Start engine to detect</div>
          </div>

        </div><!-- /tab-diag -->

      </div><!-- /panel with tabs -->

      <!-- Alerts panel (always visible in sidebar) -->
      <div class="panel" style="padding:10px;display:flex;flex-direction:column;gap:6px;flex-shrink:0;">
        <div class="panel-header" style="margin:-10px -10px 8px;border-radius:0;background:transparent;">
          <span class="panel-title">Live Alerts</span>
        </div>

        <!-- Clip Alert -->
        <div id="alert-clip" class="alert-box">
          <span class="alert-icon text-red">⚠</span>
          <div>
            <div class="alert-title text-red">Clipping Detected</div>
            <div class="alert-detail">Signal exceeds 0 dBFS ceiling</div>
          </div>
        </div>

        <!-- Feedback Alert -->
        <div id="alert-fdbk" class="alert-box">
          <span class="alert-icon text-amber">⟳</span>
          <div>
            <div class="alert-title text-amber">Feedback Risk</div>
            <div class="alert-detail">
              <span id="alert-fdbk-freq">--</span> Hz &bull;
              Note: <span id="alert-fdbk-note">--</span>
            </div>
          </div>
        </div>

        <!-- DC Offset Alert -->
        <div id="alert-dc" class="alert-box">
          <span class="alert-icon text-amber">⏚</span>
          <div>
            <div class="alert-title text-amber">DC Offset Detected</div>
            <div class="alert-detail">Check ground / electrical connections</div>
          </div>
        </div>
      </div>

    </aside><!-- /sidebar -->

    <!-- === OSCILLOSCOPE PANEL === -->
    <div id="osc-panel" class="panel">
      <div class="panel-header">
        <span class="panel-title">Oscilloscope — Time Domain</span>
        <span class="panel-badge">WAVEFORM</span>
      </div>
      <div id="osc-canvas-wrap">
        <canvas id="osc-canvas"></canvas>
      </div>
    </div>

    <!-- === SPECTROGRAM PANEL === -->
    <div id="spectrogram-panel" class="panel" style="grid-column:1;min-height:100px;">
      <div class="panel-header">
        <span class="panel-title">Spectrogram — Frequency vs Time (Waterfall)</span>
        <span class="panel-badge">LOG FREQ · REAL-TIME</span>
      </div>
      <div id="spectrogram-canvas-wrap" style="flex:1;overflow:hidden;">
        <canvas id="spectrogram-canvas"></canvas>
      </div>
    </div>

  </main><!-- /main -->

</div><!-- /app -->

<!-- =====================================================================
     STANDBY OVERLAY
     ===================================================================== -->
<div id="standby-overlay">
  <div class="standby-text">System Standby</div>
  <div class="standby-hint">Press INIT ENG to begin analysis</div>
</div>

<!-- =====================================================================
     ERROR MODAL
     ===================================================================== -->
<div id="error-modal" role="dialog" aria-modal="true" aria-labelledby="error-title">
  <div class="error-card">
    <h2 id="error-title">
      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display:inline;margin-right:8px;vertical-align:middle;">
        <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/>
        <line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/>
      </svg>
      Hardware Access Error
    </h2>
    <p id="error-msg">Microphone access is required. Please allow microphone access and try again.</p>
    <button id="error-dismiss">Dismiss</button>
  </div>
</div>

<!-- =====================================================================
     SCRIPTS — load library first, then app
     ===================================================================== -->
<script src="ordo-audio-lib/ordo-audio.js"></script>
<script src="app.js"></script>

</body>
</html>
